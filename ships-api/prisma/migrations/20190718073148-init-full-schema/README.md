# Migration `20190718073148-init-full-schema`

This migration has been generated by Tadas Antanavicius at 7/18/2019, 7:31:48 AM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "business"."Circle"("id" text NOT NULL  ,"name" text NOT NULL DEFAULT '' ,"description" text   ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."Contact"("id" text NOT NULL  ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."Person"("id" text NOT NULL  ,"firstName" text   ,"middleName" text   ,"lastName" text   ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."MediumUser"("id" text NOT NULL  ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."FacebookUser"("id" text NOT NULL  ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."LinkedinUser"("id" text NOT NULL  ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."InstagramUser"("id" text NOT NULL  ,"username" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."GithubUser"("id" text NOT NULL  ,"username" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."GoodreadsUser"("id" text NOT NULL  ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."TwitterUser"("id" text NOT NULL  ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."Phone"("id" text NOT NULL  ,"number" text NOT NULL DEFAULT '' ,"description" text   ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."WorkerOccupation"("id" text NOT NULL  ,"from" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"to" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."Occupation"("id" text NOT NULL  ,"role" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."Organization"("id" text NOT NULL  ,"name" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."EmailAddress"("id" text NOT NULL  ,"value" text NOT NULL DEFAULT '' ,"description" text   ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."Website"("id" text NOT NULL  ,"url" text NOT NULL DEFAULT '' ,"description" text   ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."Image"("id" text NOT NULL  ,"url" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."PersonLocation"("id" text NOT NULL  ,"from" timestamp(3)   ,"to" timestamp(3)   ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."Location"("id" text NOT NULL  ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."Address"("id" text NOT NULL  ,"line1" text   ,"line2" text   ,"city" text   ,"state" text   ,"zip" text   ,"country" text   ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."Degree"("id" text NOT NULL  ,"year" integer NOT NULL DEFAULT 0 ,"type" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."School"("id" text NOT NULL  ,"name" text NOT NULL DEFAULT '' ,"createdAt" timestamp(3) NOT NULL  ,"updatedAt" timestamp(3) NOT NULL DEFAULT '1970-01-01 00:00:00' ,PRIMARY KEY ("id"));

CREATE TABLE "business"."_CircleToContact"("A" text NOT NULL  REFERENCES "business"."Circle"("id"),"B" text NOT NULL  REFERENCES "business"."Contact"("id"));

ALTER TABLE "business"."Contact" ADD COLUMN "person" text   REFERENCES "business"."Person"("id"),ADD COLUMN "organization" text   REFERENCES "business"."Organization"("id");

ALTER TABLE "business"."Person" ADD COLUMN "mediumUser" text NOT NULL  REFERENCES "business"."MediumUser"("id"),ADD COLUMN "facebookUser" text NOT NULL  REFERENCES "business"."FacebookUser"("id"),ADD COLUMN "linkedinUser" text NOT NULL  REFERENCES "business"."LinkedinUser"("id"),ADD COLUMN "instagramUser" text NOT NULL  REFERENCES "business"."InstagramUser"("id"),ADD COLUMN "githubUser" text NOT NULL  REFERENCES "business"."GithubUser"("id"),ADD COLUMN "goodreadsUser" text NOT NULL  REFERENCES "business"."GoodreadsUser"("id"),ADD COLUMN "profilePicture" text   REFERENCES "business"."Image"("id");

ALTER TABLE "business"."TwitterUser" ADD COLUMN "owner" text NOT NULL  REFERENCES "business"."Person"("id");

ALTER TABLE "business"."Phone" ADD COLUMN "ownerPerson" text   REFERENCES "business"."Person"("id"),ADD COLUMN "ownerOrganization" text   REFERENCES "business"."Organization"("id");

ALTER TABLE "business"."WorkerOccupation" ADD COLUMN "worker" text NOT NULL  REFERENCES "business"."Person"("id"),ADD COLUMN "as" text NOT NULL  REFERENCES "business"."Occupation"("id");

ALTER TABLE "business"."Occupation" ADD COLUMN "at" text   REFERENCES "business"."Organization"("id");

ALTER TABLE "business"."EmailAddress" ADD COLUMN "ownerPerson" text   REFERENCES "business"."Person"("id"),ADD COLUMN "ownerOrganization" text   REFERENCES "business"."Organization"("id");

ALTER TABLE "business"."Website" ADD COLUMN "ownerPerson" text   REFERENCES "business"."Person"("id"),ADD COLUMN "ownerOrganization" text   REFERENCES "business"."Organization"("id");

ALTER TABLE "business"."PersonLocation" ADD COLUMN "resident" text NOT NULL  REFERENCES "business"."Person"("id"),ADD COLUMN "at" text NOT NULL  REFERENCES "business"."Location"("id");

ALTER TABLE "business"."Location" ADD COLUMN "address" text NOT NULL  REFERENCES "business"."Address"("id");

ALTER TABLE "business"."Degree" ADD COLUMN "student" text NOT NULL  REFERENCES "business"."Person"("id"),ADD COLUMN "school" text NOT NULL  REFERENCES "business"."School"("id");

CREATE UNIQUE INDEX "Phone.number._UNIQUE" ON "business"."Phone"("number")

CREATE UNIQUE INDEX "EmailAddress.value._UNIQUE" ON "business"."EmailAddress"("value")

CREATE UNIQUE INDEX "Website.url._UNIQUE" ON "business"."Website"("url")

CREATE UNIQUE INDEX "Image.url._UNIQUE" ON "business"."Image"("url")
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration ..20190718073148-init-full-schema
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,265 @@
+// export SHIPS_LOCAL_POSTGRES_URL=postgresql://admin:XXX@localhost:5432/ships
+// export SHIPS_PROD_POSTGRES_URL=postgresql://tadas:XXX@YYY:5432/ships
+
+datasource db {
+  enabled  = true
+  provider = "postgresql"
+  url      = env("SHIPS_LOCAL_POSTGRES_URL")
+}
+
+// datasource db {
+//   enabled   = false
+//   provider  = "postgresql"
+//   url       = env("SHIPS_PROD_POSTGRES_URL")
+// }
+
+generator photon {
+  provider = "photonjs"
+}
+
+model Circle {
+  id          String    @id @default(cuid())
+  name        String
+  description String?
+  contacts    Contact[]
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Contact {
+  id           String        @id @default(cuid())
+  circles      Circle[]
+  person       Person?
+  organization Organization?
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Person {
+  id         String  @id @default(cuid())
+  firstName  String?
+  middleName String?
+  lastName   String?
+
+  mediumUser      MediumUser?
+  facebookUser    FacebookUser?
+  linkedinUser    LinkedinUser?
+  instagramUser   InstagramUser?
+  githubUser      GithubUser?
+  goodreadsUser   GoodreadsUser?
+  twitterUser     TwitterUser?
+  personalWebsite Website?
+  profilePicture  Image?
+  work            WorkerOccupation[]
+  reside          PersonLocation[]
+  degrees         Degree[]
+  phones          Phone[]
+  emailAddresses  EmailAddress[]
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model MediumUser {
+  id    String @id @default(cuid())
+  owner Person
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model FacebookUser {
+  // TODO do I *need* the default??
+  id String @id @default(cuid())
+
+  owner Person
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model LinkedinUser {
+  id    String @id @default(cuid())
+  owner Person
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model InstagramUser {
+  id       String @id @default(cuid())
+  username String
+
+  owner Person
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model GithubUser {
+  id       String @id @default(cuid())
+  username String
+
+  owner Person
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model GoodreadsUser {
+  id    String @id @default(cuid())
+  owner Person
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model TwitterUser {
+  id    String @id @default(cuid())
+  owner Person
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Phone {
+  // TODO could just use number as PK
+  id          String  @id @default(cuid())
+  number      String  @unique
+  description String?
+
+  ownerPerson       Person?
+  ownerOrganization Organization?
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model WorkerOccupation {
+  id String @id @default(cuid())
+
+  from DateTime
+  to   DateTime
+
+  worker Person
+  as     Occupation
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Occupation {
+  id String @id @default(cuid())
+
+  role String
+
+  at Organization?
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Organization {
+  id String @id @default(cuid())
+
+  name String
+
+  emailAddresses EmailAddress[]
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model EmailAddress {
+  // TODO could just use value as PK
+  id String @id @default(cuid())
+
+  value       String  @unique
+  description String?
+
+  ownerOrganization Organization?
+  ownerPerson       Person?
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Website {
+  id          String  @id @default(cuid())
+  url         String  @unique
+  description String?
+
+  ownerPerson       Person?
+  ownerOrganization Organization?
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Image {
+  id  String @id @default(cuid())
+  url String @unique
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model PersonLocation {
+  id String @id @default(cuid())
+
+  from DateTime?
+  to   DateTime?
+
+  resident Person
+  at       Location
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Location {
+  id String @id @default(cuid())
+
+  address Address
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Address {
+  id String @id @default(cuid())
+
+  line1   String?
+  line2   String?
+  city    String?
+  state   String?
+  zip     String?
+  country String?
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model Degree {
+  id String @id @default(cuid())
+
+  year Int
+  type String
+
+  student Person
+  school  School
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
+
+model School {
+  id String @id @default(cuid())
+
+  name String
+
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
```

## Photon Usage

You can use a specific Photon built for this migration (20190718073148-init-full-schema)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20190718073148-init-full-schema'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
